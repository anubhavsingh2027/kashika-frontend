<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User History</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav id="navbar" class="sticky top-0 z-40"></nav>

    <main class="max-w-4xl mx-auto px-4 py-10">
      <div class="notloggin bg-white p-6 rounded-lg shadow hidden">
        <h2 class="text-lg">You are not logged in</h2>
      </div>
      <div class="loggin bg-white p-6 rounded-lg shadow">
        <h2 class="text-2xl font-semibold mb-4">
          Welcome, <span id="username">Guest</span>
        </h2>

        <div class="section mb-6">
          <h3 class="font-semibold">ðŸš— Car Bookings</h3>
          <div id="carHistory" class="text-slate-600">Did Not Book Car</div>
        </div>

        <div class="section">
          <h3 class="font-semibold">ðŸ§³ Package Bookings</h3>
          <div id="packageHistory" class="text-slate-600">
            Did Not Book Package
          </div>
        </div>
      </div>
    </main>

    <script type="module" src="./assets/js/DynamicNav.js"></script>
    <script type="module" src="./assets/js/tailwind-init.js"></script>
    <script type="module">
      import { getUserSession } from "./assets/js/services.js";

      async function loadUserData() {
        const data = await getUserSession();

        const loggedDiv = document.querySelector(".loggin");
        const notLoggedDiv = document.querySelector(".notloggin");

        if (data.loggedIn) {
          // âœ… Show logged-in div, hide not-logged-in div
          loggedDiv.style.display = "block";
          notLoggedDiv.style.display = "none";

          // Personalize
          document.getElementById("username").textContent = data.user.userName;
          renderHistory(data.user);
        } else {
          // âœ… Show not-logged-in div, hide logged-in div
          loggedDiv.style.display = "none";
          notLoggedDiv.style.display = "block";
        }
      }

      function renderHistory(user) {
        const carDiv = document.getElementById("carHistory");
        const pkgDiv = document.getElementById("packageHistory");

        carDiv.innerHTML = user.carBooking.length
          ? user.carBooking
              .map(
                (b) => `
        <p>ðŸš— ${b.carName} â€” ${new Date(b.date).toLocaleDateString()}</p>
      `
              )
              .join("")
          : "Did Not Book Car";

        pkgDiv.innerHTML = user.packageBook.length
          ? user.packageBook
              .map(
                (p) => `
        <p>ðŸ§³ ${p.packageName} â€” ${new Date(
                  p.bookingDate
                ).toLocaleDateString()}</p>
      `
              )
              .join("")
          : "Did Not Book Package";
      }

      // âœ… Initialize
      loadUserData();
    </script>
  </body>
</html>
